#+DATE: <2021-07-09 Fri 09:03>
#+TITLE: SM2 算法税务数字证书应用接口规范

* 简介

本规范规定了 SM2 算法税务数字证书应用接口的类型、功能、数据格式、密码算法等内容。

** 术语和定义

_SM2 算法_ 是由国家密码管理局批准的一种椭圆曲线公钥密码算法。

_数字证书_ 是由国家认可的，具有权威性、可信性和公正性的认证机构进行数字签名，包含公开密钥拥有者信息、公开密钥、签发者信息、有效期以及一些扩展信息的数字化文件。

_税务数字证书_ 是指由税务数字证书系统所签发的数字证书。

_SM2 算法税务数字证书_ 是指由 SM2 算法税务数字证书系统所签发的数字证书，其对应的公钥算法为 SM2 。

_密钥容器_ 是指密码设备中用于保存密钥和数字证书所划分的存储空间。

_国标接口_ 是指遵循密码管理局制定的密码设备相关规范的应用接口。

_签名验签服务器_ 为应用系统 提供基于 PKI 体系和数字证书的数字签名、验证签名等运算功能的服务器，可以保证关键业务信息的真实性、完整性和不可否认性。

** 缩略语

*仅适用于本文件

| LDAP | 轻量级目录访问协议 |
| OCSP | 在线证书状态协议   |
| OID  | 对象标识符         |
| PKI  | 公钥密码基础设施   |

** 证书应用接口

证书应用接口提供证书读取、身份认证、数字签名、签名验证、数字信封加解密等功能。

_1. 接口类型_

证书应用接口包括服务端接口和客户端接口。

_服务端接口_ 是部署在应用系统服务端，通过 *签名验签服务器* 实现身份认证、数字签名、签名验证、数字信封加解密等安全功能的接口。

_客户端接口_ 是部署在应用系统客户端，通过 *税务数字证书介质* 实现身份认证、数字签名、签名验证、数字信封加解密等安全功能的接口。

_2. 接口功能_

证书应用接口实现的功能包括：
1. 读取证书；
2. 解析证书内容；
3. 身份认证；
4. 数据摘要；
5. 数字签名；
6. 签名验证；
7. 制作数字信封；
8. 解数字信封。

_3. 接口密码设备_

证书应用接口支持的 *密码设备* 类型有：
- 服务端密码设备 - 签名验签服务器；
- 客户端密码设备 - 支持国标接口的税务数字证书介质，包括但不限于 USBKey、SIM 卡、PSAM 卡、金税盘、税控盘、税务 UKey 和税控服务器等多种形态的证书介质。

密码设备通过划分多个密钥容器存储多对公钥和证书，根据密钥容器名称获取对应容器的密钥和证书。

* 客户端接口

客户端接口采用 WEB 服务方式，可供浏览器和多种语言调用，用于客户端设备（如 USBKey、税控服务器和税务 UKey 等）读取信息、身份认证、签名验证等操作。

#+CAPTION: 接口方法
| 序号 | 接口方法                                 | 功能               |
| <c>  |                                          |                    |
|------+------------------------------------------+--------------------|
| 1    | ~https://host:port/api/getVersion~       | 获取接口版本号     |
| 2    | ~https://host:port/api/devicecertreq~    | 生成设备证书申请   |
| 3    | ~https://host:port/api/importdevicecert~ | 导入设备证书       |
| 4    | ~https://host:port/api/certreq~          | 生成用户证书申请   |
| 5    | ~https://host:port/api/importcert~       | 导入用户证书       |
| 6    | ~https://host:port/api/clientHello~      | 生成客户端认证请求 |
| 7    | ~https://host:port/api/clientAuth~       | 生成客户端认证凭据 |
| 8    | ~https://host:port/api/checkCert~        | 检查容器           |
| 9    | ~https://host:port/api/readCert~         | 读证书             |
| 10   | ~https://host:port/api/readCertInfo~     | 解析证书信息       |
| 11   | ~https://host:port/api/destroy~          | 销毁用户证书       |
| 12   | ~https://host:port/api/sign~             | SM2 签名           |
| 13   | ~https://host:port/api/verify~           | 验证 SM2 签名      |
| 14   | ~https://host:port/api/signData~         | SM2 消息签名       |
| 15   | ~https://host:port/api/verifySign~       | 验证 SM2 消息签名  |
| 16   | ~https://host:port/api/digestData~       | 消息摘要           |
| 17   | ~https://host:port/api/envelop~          | 制作数字信封       |
| 18   | ~https://host:port/api/unEnvelope~       | 解密数字信封       |

* TODO 服务器端接口

暂不用……

* *密码相关拓展

#+BEGIN_EXPORT html
<img
src="https://www.ruanyifeng.com/blogimg/asset/201307/bg2013070301.png"
width="120"
height=""
style="float: right; margin-left: 8px; "
title=""
/>
#+END_EXPORT

- [[https://www.ruanyifeng.com/blog/2006/12/notes_on_cryptography.html][密码学笔记]]
- [[https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html][RSA 算法原理（一）]]
- [[https://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html][RSA 算法原理（二）]]

#+BEGIN_EXPORT html
<essay>
Hmm... 数学，这个奇妙的东西，真的让人爱恨交加！
</essay>
#+END_EXPORT
